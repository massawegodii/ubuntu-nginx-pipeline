<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NGINX Configuration Guide</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
            color: #333;
        }
        header {
            background: #333;
            color: #fff;
            padding: 1rem 0;
            text-align: center;
        }
        .container {
            width: 80%;
            margin: auto;
            overflow: hidden;
            padding: 20px;
        }
        section {
            margin: 20px 0;
            padding: 20px;
            background: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        code {
            display: block;
            background: #f4f4f9;
            border-left: 4px solid #333;
            color: #666;
            padding: 10px;
            margin: 10px 0;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        h2 {
            color: #333;
        }
        a {
            color: #0073e6;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <header>
        <h1>NGINX Configuration Guide</h1>
    </header>

    <div class="container">
        <section>
            <h2>Connect to Your Server</h2>
            <p>Use the following command to connect to your server:</p>
            <code>ssh root@12.345.45.678</code>
        </section>

        <section>
            <h2>Install NGINX</h2>
            <p>Run the command below to install NGINX:</p>
            <code>sudo apt-get install nginx</code>
            <code>sudo apt-get install nginx</code>
        </section>

        <section>
            <h2>Clone Your Node.js Backend Repository</h2>
            <p>Navigate to your backend directory and clone the repository:</p>
            <code>
cd /var/www<br>
git clone https://github.com/&lt;your-username&gt;/&lt;your-repo&gt;.git backend<br>
cd backend
            </code>
            <p>Edit the environment variables:</p>
            <code>
sudo vim .env<br>
API="http://12.345.45.678/api";<br>
# Save and exit using ESC + :wq
            </code>
        </section>

        <section>
            <h2>Configure NGINX for Your Subdomain</h2>
            <p>Create an NGINX configuration file:</p>
            <code>
nano /etc/nginx/sites-available/backend
            </code>
            <p>Add the following configuration:</p>
            <code>
server {
    listen 80;
    server_name api.www.kiganjaniafyacheck.com;
    root /var/www/backend;
    index index.js;

    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    error_page 404 /404.html;
    location = /404.html {
        root /usr/share/nginx/html;
    }
}
            </code>
            <p>Enable the configuration and test:</p>
            <code>
ln -s /etc/nginx/sites-available/backend /etc/nginx/sites-enabled/<br>
nginx -t<br>
systemctl reload nginx
            </code>
        </section>

        <section>
            <h2>Secure the Subdomain with Let's Encrypt</h2>
            <p>Install Certbot and obtain an SSL certificate:</p>
            <code>
sudo apt update<br>
sudo apt install certbot python3-certbot-nginx -y<br>
certbot --nginx -d api.www.kiganjaniafyacheck.com
            </code>
            <p>Verify auto-renewal:</p>
            <code>certbot renew --dry-run</code>
        </section>

        <section>
            <h2>Install and Configure PM2</h2>
            <p>Install PM2 globally:</p>
            <code>npm install -g pm2</code>
            <p>Start your app and save the process:</p>
            <code>
pm2 start index.js --name "backend"<br>
pm2 save<br>
pm2 startup
            </code>
            <p>To kill the running process:</p>
            <code>pm2 kill</code>
        </section>

        <section>
            <h2>Angular Application Configuration</h2>
            <p>Clone your Angular project and build it:</p>
            <code>
ssh root@&lt;your-server-ip&gt;<br>
cd /var/www<br>
git clone https://github.com/&lt;your-username&gt;/&lt;your-angular-repo&gt;.git web-upload<br>
cd web-upload<br>
npm install<br>
npm run build --prod
            </code>
            <p>Configure NGINX for Angular:</p>
            <code>
nano /etc/nginx/sites-available/web-upload
            </code>
            <p>Add the following configuration:</p>
            <code>
server {
    listen 80;
    server_name web.www.kiganjaniafyacheck.com;

    root /var/www/web-upload/dist/image-upload/browser;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    error_page 404 /index.html;

    location ~ /\. {
        deny all;
    }
}
            </code>
            <p>Test and reload NGINX:</p>
            <code>
sudo nginx -t<br>
sudo systemctl reload nginx
            </code>
            <p>Verify Permissions:</p>
            <code>
sudo chmod -R 755 /var/www/web-upload/dist/image-upload/browser<br>
sudo chown -R www-data:www-data /var/www/web-upload/dist/image-upload/browser
            </code>
        </section>

        <section>
            <h2>Bonus Steps</h2>
            <p>To remove packages:</p>
            <code>rm -rf node_modules package-lock.json</code>
            <p>Create a directory if not exists:</p>
            <code>
sudo mkdir -p /etc/nginx/sites-available<br>
cd /etc/nginx/sites-available<br>
sudo nano /etc/nginx/sites-available/backend
            </code>
            <p>Check the NGINX error logs:</p>
            <code>sudo tail -f /var/log/nginx/error.log</code>
        </section>

        <section>
            <h2>Architect.build.configurations.production section under your project</h2>
            <p>In package.json</p>
            <code>
        "configurations": {
            "production": {
                "fileReplacements": [
                    {
                        "replace": "src/environments/environment.ts",
                        "with": "src/environments/environment.prod.ts"
                    }
                ],
                "optimization": true,
                "outputHashing": "all",
                "sourceMap": false,
                "extractCss": true,
                "namedChunks": false,
                "aot": true,
                "extractLicenses": true,
                "vendorChunk": false,
                "buildOptimizer": true
            }
                }
            </code>

        </section>


        <section>
            <h2>Set Up the Ubuntu Server in Single Page</h2>
            <p>Install Required Software</p>
            <code>
sudo apt update && sudo apt upgrade -y <br>
sudo apt install nginx git curl -y <br>
                
# Optional: Install Node.js if your project requires it <br>
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash - <br>
sudo apt install nodejs -y
                
            </code>
            <p>Configure NGINX for the Subdomain</p>
            <code>sudo nano /etc/nginx/sites-available/me.shulekwanza.co.tz
            </code>

            <p>Add the following content to the file</p>
            <code>
    server {
        listen 80;
        server_name me.shulekwanza.co.tz;

        root /var/www/me.shulekwanza.co.tz;
        index index.html index.htm;

        location / {
            try_files $uri /index.html;
        }

        error_page 404 /404.html;

        # Reverse proxy for backend (if needed)
        location /api/ {
            proxy_pass http://localhost:3000;  # Change to your backend port
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;
        }
    }

                
            </code>
            <p>Create the web root directory</p>
            <code>
sudo mkdir -p /var/www/me.shulekwanza.co.tz <br>
sudo chown -R root /var/www/me.shulekwanza.co.tz
                
            </code>
            <p>Enable the configuration and restart NGINX</p>
            <code>
sudo ln -s /etc/nginx/sites-available/me.shulekwanza.co.tz /etc/nginx/sites-enabled/ <br>
sudo nginx -t <br>
sudo systemctl reload nginx
            </code>                
        </section>

        <section>
            <h2>Enable HTTPS with Let's Encrypt</h2>
            <p>Install Certbot</p>
            <code>
sudo apt install certbot python3-certbot-nginx -y 
             </code>

            <p>Obtain and configure an SSL certificate</p>
            <code>
sudo certbot --nginx -d me.shulekwanza.co.tz
             </code>

             <p>Test the SSL renewal process</p>
            <code>
sudo certbot renew --dry-run
             </code>
             
             <p>Create or Update an HTML File and Paste </p>
             <code>
nano index.html
             </code>

             <p>Set Proper Permissions: Ensure the NGINX process can read the files </p>
             <code>
sudo chown -R www-data:www-data /var/www/me.shulekwanza.co.tz <br>
sudo chmod -R 755 /var/www/me.shulekwanza.co.tz    
             </code>

             <p>Reload NGINX </p>
             <code>
sudo systemctl reload nginx
            </code>
            <p>
                Place any additional assets (e.g., CSS, JS, images) in appropriately named subdirectories within /var/www/me.shulekwanza.co.tz (e.g., /css, /js, /images) and reference them in your HTML code.
            </p>
        </section>

        <section>
            <h2>Final Steps</h2>
            <p>Access your applications:</p>
            <ul>
                <li>Backend API: <a href="https://api.www.kiganjaniafyacheck.com">https://api.www.kiganjaniafyacheck.com</a></li>
                <li>Angular App: <a href="https://web.www.kiganjaniafyacheck.com">https://web.www.kiganjaniafyacheck.com</a></li>
            </ul>
        </section>
    </div>
</body>
</html>
